name: CI on NVIDIA GPU

on:
  pull_request:
    types: [labeled]
  workflow_dispatch:

jobs:
  ci:
    if: github.event.label.name == 'ci-nvidia-needed'
    runs-on: ubuntu-latest
    env:
      MODAL_TOKEN_ID: ${{ secrets.MODAL_TOKEN_ID }}
      MODAL_TOKEN_SECRET: ${{ secrets.MODAL_TOKEN_SECRET }}
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    - name: Install uv
      uses: astral-sh/setup-uv@v5
    - name: Install dependencies
      run: uv sync --group dev
    - name: Run tests on NVIDIA GPU
      run: uv run modal run ci.nvidia
